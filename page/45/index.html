<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.1.1" name=generator><link href=https://fonts.googleapis.com rel=preconnect><link href=https://cdnjs.cloudflare.com rel=preconnect><link href=https://www.longluo.me/assets/logo/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://www.longluo.me/assets/logo/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://www.longluo.me/assets/logo/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=n6mekvZa-QaR3EnDD-CzJymq7mGubpU7rvoGpKROHLE name=google-site-verification><meta content=6BFBD4DDDB3B6F4FDD26CF82BADDB931 name=msvalidate.01><meta content=a2ab49d952ea45f5 name=yandex-verification><meta content=www.longluo.me name=baidu-site-verification><link href=/css/main.css rel=stylesheet><link as=style href=https://fonts.googleapis.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext onload=this.rel='stylesheet' rel=preload><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity=sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"www.longluo.me","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":5,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/config.min.js></script><meta content="A Curious Engineer" name=description><meta content=website property=og:type><meta content="Long Luo's Life Notes" property=og:title><meta content=https://www.longluo.me/page/45/index.html property=og:url><meta content="Long Luo's Life Notes" property=og:site_name><meta content="A Curious Engineer" property=og:description><meta content=zh_CN property=og:locale><meta content="Long Luo" property=article:author><meta content="longluo, Tech, Tech Blog, 技术博客, Personal Blog, 个人博客, Blogger, 博客, Math, 数学, Physics, 物理, Software Engineer, 软件工程师, Program, 编程, 程序员, 码农, Java, C, C++, Data Structures, 数据结构, Algorithm, 算法, Life, 生活," property=article:tag><meta content=summary name=twitter:card><link href=https://www.longluo.me/page/45/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/45/index.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Long Luo's Life Notes</title><script async src=https://www.googletagmanager.com/gtag/js?id=UA-46213499-2></script><script class=next-config data-name=google_analytics type=application/json>{"tracking_id":"UA-46213499-2","only_pageview":false,"measure_protocol_api_secret":null}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/analytics/google-analytics.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/analytics/baidu-analytics.min.js></script><script async src=https://hm.baidu.com/hm.js?a75fb5d0c0ef1e36c34b7f52bb7c48be></script><script async src=https://assets.growingio.com/2.1/gio.js></script><script class=next-config data-name=growingio_analytics type=application/json>"bc65befc551b6d70"</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/analytics/growingio.min.js></script><script>(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "gz2vdkhgvh");</script><script async data-host-url=longluo.me data-website-id=2a6d2bf9-2adf-474b-a292-84ca30206507 defer src=https://analytics.us.umami.is/script.js></script><script data-domain=longluo.me defer src=https://plausible.io/js/script.js></script><link href=https://waline.longluo.me/ rel=dns-prefetch><noscript><link href=/css/noscript.css rel=stylesheet></noscript><style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><link title="Long Luo's Life Notes" href=/atom.xml rel=alternate type=application/atom+xml><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <h1 class=site-title>Long Luo's Life Notes</h1> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>每一天都是奇迹</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-works"><a href=/works rel=section><i class="fa fa-code fa-fw"></i>works</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt="Long Luo" class=site-author-image itemprop=image src=https://www.longluo.me/assets/avatar/sinc_3d_python.png><p class=site-author-name itemprop=name>Long Luo<div class=site-description itemprop=description>A Curious Engineer</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>347</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>24</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>336</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/longluo" href=https://github.com/longluo target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="ZhiHu → http://www.zhihu.com/people/longluo" href=http://www.zhihu.com/people/longluo target=_blank><i class="fab fa-quora fa-fw"></i>ZhiHu</a> </span><span class=links-of-author-item> <a rel="noopener me" title="LinkedIn → https://www.linkedin.com/in/longluo/" href=https://www.linkedin.com/in/longluo/ target=_blank><i class="fa fa-linkedin fa-fw"></i>LinkedIn</a> </span><span class=links-of-author-item> <a rel="noopener me" title="E-Mail → mailto:luolong0226@163.com" href=mailto:luolong0226@163.com target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span></div><div class="cc-license animated" itemprop=license><a class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></a></div></div></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://blog.csdn.net/tcpipstack rel=noopener target=_blank title=http://blog.csdn.net/tcpipstack>My CSDN</a><li class=links-of-blogroll-item><a href=https://www.ruanyifeng.com/home.html rel=noopener target=_blank title=https://www.ruanyifeng.com/home.html>阮一峰老师</a><li class=links-of-blogroll-item><a href=https://hutusi.com/ rel=noopener target=_blank title=https://hutusi.com/>胡涂说</a><li class=links-of-blogroll-item><a href=https://www.qtmuniao.com/ rel=noopener target=_blank title=https://www.qtmuniao.com/>木鸟杂记</a><li class=links-of-blogroll-item><a href=https://yufan.me/ rel=noopener target=_blank title=https://yufan.me/>雨帆</a></ul></div></div></aside></div><div class="main-inner index posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2017/12/27/top-9-questions-about-java-maps/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2017/12/27/top-9-questions-about-java-maps/ itemprop=url>Top 9 Questions About Java Maps</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2017-12-27 11:18:22" datetime=2017-12-27T11:18:22+08:00>2017-12-27</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-12-13 21:40:01" datetime=2024-12-13T21:40:01+08:00 itemprop=dateModified>2024-12-13</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Java/ itemprop=url rel=index><span itemprop=name>Java</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2017/12/27/top-9-questions-about-java-maps/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2017/12/27/top-9-questions-about-java-maps/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2017/12/27/top-9-questions-about-java-maps/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>6.3k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>6 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p>In general, Map is a data structure consisting of a set of key-value pairs, and each key can only appears once in the map. This post summarizes Top 9 FAQ of how to use Java Map and its implemented classes. For sake of simplicity, I will use generics in examples. Therefore, I will just write Map instead of specific Map. But you can always assume that both the K and V are comparable, which means K extends Comparable and V extends Comparable.<h1 id=convert-a-map-to-list>1. Convert a Map to List</h1><p>In Java, Map interface provides three collection views: key set, value set, and keyvalue set. All of them can be converted to List by using a constructor or addAll() method. The following snippet of code shows how to construct an ArrayList from a map.<figure class="highlight java"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=comment>// key list</span></span><br><span class=line><span class=type>List</span> <span class=variable>keyList</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ArrayList</span>(map.keySet());</span><br><span class=line><span class=comment>// value list</span></span><br><span class=line><span class=type>List</span> <span class=variable>valueList</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ArrayList</span>(map.valueSet());</span><br><span class=line><span class=comment>// key value list</span></span><br><span class=line><span class=type>List</span> <span class=variable>entryList</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ArrayList</span>(map.entrySet());</span><br></pre></table></figure><h1 id=iterate-over-each-entry-in-a-map>2. iterate over each entry in a map</h1><p>Iterating over every pair of key-value is the most basic operation to traverse a map. In Java, such pair is stored in the map entry called Map.Entry.<h1 id=sort-a-map-on-the-keys>3. SORT A MAP ON THE KEYS</h1><p>Map.entrySet() returns a key-value set, therefore the most efficient way of going through every entry of a map is<figure class="highlight java"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>for</span> (Entry entry:map.entrySet()) {</span><br><span class=line>    <span class=comment>// get key</span></span><br><span class=line>    <span class=type>K</span> <span class=variable>key</span> <span class=operator>=</span> entry.getKey();</span><br><span class=line>    <span class=comment>// get value</span></span><br><span class=line>    <span class=type>V</span> <span class=variable>value</span> <span class=operator>=</span> entry.getValue();</span><br><span class=line>}</span><br></pre></table></figure><p>Iterator can also be used, especially before JDK 1.5<figure class="highlight java"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=type>Iterator</span> <span class=variable>itr</span> <span class=operator>=</span> map.entrySet().iterator();</span><br><span class=line><span class=keyword>while</span>(itr.hasNext ( ) ) {</span><br><span class=line>Entry <span class=type>ent</span> <span class=variable>ry</span> <span class=operator>=</span> i t r . next ( ) ;</span><br><span class=line>/ / g e t k ey</span><br><span class=line><span class=type>K</span> <span class=variable>key</span> <span class=operator>=</span> ent ry . getKey ( ) ;</span><br><span class=line>/ / g e t v a l u e</span><br><span class=line><span class=type>V</span> <span class=variable>value</span> <span class=operator>=</span> ent ry . getValue ( ) ;</span><br><span class=line>}</span><br></pre></table></figure><p>60.3 sort a map on the keys Sorting a map on the keys is another frequent operation. One way is to put Map.Entry into a list, and sort it using a comparator that sorts the value. Li s t l i s t = new Ar rayLi s t (map. ent rySe t ( ) ) ; Co l l e c t i ons . s o r t ( l i s t , new Comparator ( ) { <span class=citation data-cites=Override>@Override</span> public int compare ( Entry e1 , Entry e2 ) { return e1 . getKey ( ) . compareTo ( e2 . getKey ( ) ) ; } });<p>The other way is to use SortedMap, which further provides a total ordering on its keys. Therefore all keys must either implement Comparable or be accepted by the comparator.<h2 id=sort-a-map-on-the-values>4. SORT A MAP ON THE VALUES</h2><p>One implementing class of SortedMap is TreeMap. Its constructor can accept a comparator. The following code shows how to transform a general map to a sorted map.<p>SortedMap sortedMap = new TreeMap (new Comparator ( ) { <span class=citation data-cites=Override>@Override</span> public int compare (K k1 , K k2 ) { return k1 . compareTo ( k2 ) ; } } ) ; sortedMap . putAll (map) ; 60.4 sort a map on the values Putting the map into a list and sorting it works on this case too, but we need to compare Entry.getValue() this time. The code below is almost same as before. Li s t l i s t = new Ar rayLi s t (map. ent rySe t ( ) ) ; Co l l e c t i ons . s o r t ( l i s t , new Comparator ( ) { <span class=citation data-cites=Override>@Override</span> public int compare ( Entry e1 , Entry e2 ) { return e1 . getValue ( ) . compareTo ( e2 . getValue ( ) ) ; } } ) ; We can still use a sorted map for this question, but only if the values are unique too. Under such condition, you can reverse the key=value pair to value=key. This solution has very strong limitation therefore is not really recommended by me. 60.5 initialize a static/immutable map When you expect a map to remain constant, it’s a good practice to copy it into an immutable map. Such defensive programming techniques will help you create not only safe for use but also safe for thread maps. 60.6. DIFFERENCE BETWEEN HASHMAP, TREEMAP, AND HASHTABLE 217 To initialize a static/immutable map, we can use a static initializer (like below). The problem of this code is that, although map is declared as static final, we can still operate it after initialization, like Test.map.put(3,“three”);. Therefore it is not really immutable. To create an immutable map using a static initializer, we need an extra anonymous class and copy it into a unmodifiable map at the last step of initialization. Please see the second piece of code. Then, an UnsupportedOperationException will be thrown if you run Test.map.put(3,“three”);. public c l a s s Tes t { pr ivate s t a t i c f ina l Map map; s t a t i c { map = new HashMap ( ) ; map. put ( 1 , ” one ” ) ; map. put ( 2 , ” two ” ) ; } } public c l a s s Tes t { pr ivate s t a t i c f ina l Map map; s t a t i c { Map aMap = new HashMap ( ) ; aMap. put ( 1 , ” one ” ) ; aMap. put ( 2 , ” two ” ) ; map = Co l l e c t i ons . unmodifiableMap (aMap) ; } } Guava libraries also support different ways of intilizaing a static and immutable collection. To learn more about the benefits of Guava’s immutable collection utilities, see Immutable Collections Explained in Guava User Guide. 60.6 difference between hashmap, treemap, and hashtable There are three main implementations of Map interface in Java: HashMap, TreeMap, and Hashtable. The most important differences include: The order of iteration. HashMap and HashTable make no guarantees as to the order of the map; in particular, they do not guarantee that the order 60.7. A MAP WITH REVERSE VIEW/LOOKUP 218 will remain constant over time. But TreeMap will iterate the whole entries according the “natural ordering” of the keys or by a comparator. key-value permission. HashMap allows null key and null values. HashTable does not allow null key or null values. If TreeMap uses natural ordering or its comparator does not allow null keys, an exception will be thrown. Synchronized. Only HashTable is synchronized, others are not. Therefore, “if a thread-safe implementation is not needed, it is recommended to use HashMap in place of HashTable.” A more complete comparison is | HashMap | HashTable | TreeMap i t e r a t i o n order | no | no | yes null key value | yes yes | yes yes | no yes synchronized | no | yes | no time performance | O( 1 ) | O( 1 ) | O( log n) implementation | buckets | buckets | red black t r e e Read more about HashMap vs. TreeMap vs. Hashtable vs. LinkedHashMap. 60.7 a map with reverse view/lookup Sometimes, we need a set of key-key pairs, which means the map’s values are unique as well as keys (one-to-one map). This constraint enables to create an “inverse lookup/view” of a map. So we can lookup a key by its value. Such data structure is called bidirectional map, which unfortunetely is not supported by JDK. 60.8 both apache common collections and guava provide implementation of bidirectional map, called bidimap and bimap, respectively. both enforce the restriction that there is a 1:1 relation between keys and values. 7. shallow copy of a map Most implementation of a map in java, if not all, provides a constructor of copy of another map. But the copy procedure is not synchronized. That means when 60.9. FOR THIS REASON, I WILL NOT EVEN TELL YOU HOW TO USE CLONE() METHOD TO COPY one thread copies a map, another one may modify it structurally. To prevent accidental unsynchronized copy, one should use Collections.synchronizedMap() in advance.<p>Map copiedMap = Co l l e c t i ons.synchronizedMap (map) ; Another interesting way of shallow copy is by using clone() method. However it is NOT even recommended by the designer of Java collection framework, Josh Bloch. In a conversation about “Copy constructor versus cloning“, he said I often provide a public clone method on concrete classes because people expect it.<p>It’s a shame that Cloneable is broken, but it happens. Cloneable is a weak spot, and I think people should be aware of its limitations.<p>60.9 for this reason, i will not even tell you how to use clone() method to copy a map. 8. create an empty map If the map is immutable, use map = Co l l e c t i ons . emptyMap ( ) ;<p>Otherwise, use whichever implementation. For example map = new HashMap ( ) ;<p>THE</div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2017/12/10/android-jni/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2017/12/10/android-jni/ itemprop=url>android jni</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2017-12-10 13:58:53" datetime=2017-12-10T13:58:53+08:00>2017-12-10</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-12-13 21:14:11" datetime=2024-12-13T21:14:11+08:00 itemprop=dateModified>2024-12-13</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Android/ itemprop=url rel=index><span itemprop=name>Android</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2017/12/10/android-jni/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2017/12/10/android-jni/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2017/12/10/android-jni/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>354</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>1 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><h1 id=静态注册>静态注册</h1><h1 id=动态注册>动态注册</h1><h1 id=参考文献>参考文献</h1><ol type=1><li><a href=https://en.wikipedia.org/wiki/Java_Native_Interface rel=noopener target=_blank>JNI</a><li><a href=https://developer.android.com/ndk/guides?hl=zh-cn rel=noopener target=_blank>NDK 使用入门</a><li><a href=https://developer.android.com/ndk/guides/cmake?hl=zh-cn rel=noopener target=_blank>CMake</a><li><a href=https://developer.android.com/ndk/guides/other_build_systems?hl=zh-cn rel=noopener target=_blank>将 NDK 与其他构建系统配合使用</a><li><a href=https://developer.android.com/ndk/samples/sample_hellojni?hl=zh-cn rel=noopener target=_blank>示例：hello-jni</a></ol><p>https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/intro.html<p>https://medium.com/<span class=citation data-cites=sarafanshul/jni-101-introduction-to-java-native-interface-8a1256ca4d8e>@sarafanshul/jni-101-introduction-to-java-native-interface-8a1256ca4d8e</span><p>https://medium.com/<span class=citation data-cites=sarafanshul/jni-201-dynamic-registration-a1ad7fa50b21>@sarafanshul/jni-201-dynamic-registration-a1ad7fa50b21</span><p>https://gist.github.com/okamayana/79c98545eb99c4877979</div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2017/11/28/3-basic-rules-for-hiring-new-employees/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2017/11/28/3-basic-rules-for-hiring-new-employees/ itemprop=url>如何招到优秀的员工？</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2017-11-28 22:22:02" datetime=2017-11-28T22:22:02+08:00>2017-11-28</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-11-14 22:24:40" datetime=2023-11-14T22:24:40+08:00 itemprop=dateModified>2023-11-14</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Work/ itemprop=url rel=index><span itemprop=name>Work</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2017/11/28/3-basic-rules-for-hiring-new-employees/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2017/11/28/3-basic-rules-for-hiring-new-employees/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2017/11/28/3-basic-rules-for-hiring-new-employees/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>388</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>1 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p><strong>招聘</strong>其实本质上是在做<strong><em>风险评估</em></strong>，根据简历和面试确定风险最小的那个人。<p>其实这个风险评估可以推而广之适用于涉及选择的各个场合。<p>最近在协助公司招人，也为项目组面试了一些人，对招人也有了一些思考。<p>为了避免招到不合适的人，将风险降到最低，那么就会从各方面均衡考虑。<p>从面试官的角度来看，为什么要名校和名企出身的人。<p>第一，因为名企已经帮你做了一次筛选了，尤其是校招进入BAT的，更是万里挑一，所以风险可以降到最低。<p>第二，学历其实也是一项筛选。学历可以证明你的学习能力以及把握机会的能力（高考是一次可以改变人生轨迹的机会。）。<p>第三，如果没有名企和学历的光环，那么你就要用你做成功的事情来证明你自己确实出类拔萃。<p>综合，应聘者需要用一些东西来证明自己比其他应聘者更优秀，而且实力已经得到证明，而不是到新公司体现和证明。<p><strong><em>By Long Luo <span class=citation data-cites=2017-11-28>@2017-11-28</span> at Shenzhen.</em></strong></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2017/11/10/josephus-problem/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2017/11/10/josephus-problem/ itemprop=url>经典算法：从约瑟夫问题(Josephus problem)说开去...</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2017-11-10 23:27:04" datetime=2017-11-10T23:27:04+08:00>2017-11-10</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-11-14 22:24:40" datetime=2023-11-14T22:24:40+08:00 itemprop=dateModified>2023-11-14</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Data-Structures-and-Algorithms/ itemprop=url rel=index><span itemprop=name>Data Structures and Algorithms</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2017/11/10/josephus-problem/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2017/11/10/josephus-problem/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2017/11/10/josephus-problem/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>3.1k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>3 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p><strong>约瑟夫问题(Josephus problem)</strong> <a class=footnote-ref href=#fn1 id=fnref1 role=doc-noteref><sup>1</sup></a> 是每个学计算机的同学都会遇到的经典编程题，可以考察链表、递归、数学等知识，下面我们就来通过这道题对好好学习下算法和编程吧，Let’s go!<h1 id=一约瑟夫问题>一、约瑟夫问题</h1><p>据说著名犹太历史学家 <span class="math inline">\(\textit{Josephus}\)</span> 有过以下的故事：<blockquote><p>在罗马人占领乔塔帕特后，<span class="math inline">\(39\)</span> 个犹太人与 <span class="math inline">\(\textit{Josephus}\)</span> 及他的朋友躲到一个洞中，<span class="math inline">\(39\)</span> 个犹太人决定宁愿死也不要被敌人抓到，于是决定了一个自杀方式，<span class="math inline">\(41\)</span> 个人排成一个圆圈，由第 <span class="math inline">\(1\)</span> 个人开始报数，每报数到第 <span class="math inline">\(3\)</span> 人该人就必须自杀，然后再由下一个重新报数，直到所有人都自杀身亡为止。</blockquote><p>然而 <span class="math inline">\(\textit{Josephus}\)</span> 和他的朋友并不想遵从这个规则，<span class="math inline">\(\textit{Josephus}\)</span> 要他的朋友先假装遵从，他将朋友与自己安排在第 <span class="math inline">\(16\)</span> 个与第 <span class="math inline">\(31\)</span> 个位置，于是逃过了这场死亡游戏。<h1 id=二约瑟夫问题算法分析>二、约瑟夫问题算法分析</h1><p>约瑟夫问题可用代数分析来求解，将这个问题扩大好了，假设现在您与 <span class="math inline">\(N\)</span> 个朋友不幸参与了这个游戏，您要如何保护您与您的朋友？<p>只要画两个圆圈就可以让自己与朋友免于死亡游戏，这两个圆圈内圈是排列顺序，而外圈是自杀顺序，如下图所示：<figure><img alt="Josephus Problem" src=https://user-images.githubusercontent.com/3395062/251418572-e0b229c1-71cc-43d6-9297-6c7934175135.svg><figcaption aria-hidden=true>Josephus Problem</figcaption></figure><p>假如使用编程来求解的话，只要将 <span class="math inline">\(\textit{array}\)</span> 当作环状来处理就可以了，在 <span class="math inline">\(\textit{array}\)</span> 中由计数 <span class="math inline">\(1\)</span> 开始，每找到 <span class="math inline">\(3\)</span> 个无数据区就填入 <span class="math inline">\(1\)</span> 个计数，直到计数达 <span class="math inline">\(41\)</span> 为止，然后将 <span class="math inline">\(\textit{array}\)</span> 由索引 <span class="math inline">\(1\)</span> 开始列出，就可以得知每个位置的自杀顺序，这就是约瑟夫排列，<span class="math inline">\(41\)</span> 个人而报数 <span class="math inline">\(3\)</span> 的约琴夫排列如下所示：<blockquote><p>14 36 1 38 15 2 24 30 3 16 34 425 17 5 40 31 6 18 26 7 37 19 8 35 27 9 20 32 10 41 21 11 28 39 12 22 33 13 29 23</blockquote><p>由上可知，最后一个自杀的是在第 <span class="math inline">\(31\)</span> 个位置，而倒数第二个自杀的要排在第 <span class="math inline">\(16\)</span> 个位置，而之前的人都死光了，所以他们也就不知道约瑟夫与他的朋友并没有遵守游戏规则了。<p>这是一道经典算法问题，每个学编程的同学都会遇到。一般常见的问法有以下几种：<ol type=1><li>输出自杀顺序；<li>输出最后一个自杀同学编号。</ol><p>下面我们就来动手实践下，具体实现代码如下所示：<figure class="highlight java"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre><td class=code><pre><span class=line><span class=keyword>private</span> <span class=keyword>static</span> <span class=type>int</span> <span class="title function_">Josephus</span><span class=params>(<span class=type>int</span> n, <span class=type>int</span> m)</span> {</span><br><span class=line>	    <span class=type>int</span>[] peopleArr = <span class=keyword>new</span> <span class="title class_">int</span>[n];</span><br><span class=line>	    <span class=keyword>for</span> (<span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>0</span>; i < n; i++) {</span><br><span class=line>	        peopleArr[i] = i + <span class=number>1</span>;</span><br><span class=line>	    }</span><br><span class=line>	</span><br><span class=line>	    <span class=type>int</span> <span class=variable>index</span> <span class=operator>=</span> <span class=number>0</span>;</span><br><span class=line>	    <span class=type>int</span> <span class=variable>length</span> <span class=operator>=</span> n;</span><br><span class=line>	    <span class=type>int</span> <span class=variable>count</span> <span class=operator>=</span> <span class=number>1</span>;</span><br><span class=line>	</span><br><span class=line>	    <span class=keyword>while</span> (length > <span class=number>0</span>) {</span><br><span class=line>	        <span class=keyword>if</span> (peopleArr[index % n] > <span class=number>0</span>) {</span><br><span class=line>	            <span class=keyword>if</span> (count % m == <span class=number>0</span>) {</span><br><span class=line>	                <span class=comment>// 找到要出圈的人，并把圈中人数减1</span></span><br><span class=line>	                System.out.print(peopleArr[index % n] + <span class=string>"  "</span>);</span><br><span class=line>	                peopleArr[index % n] = -<span class=number>1</span>;</span><br><span class=line>	                count = <span class=number>1</span>;</span><br><span class=line>	                index++;</span><br><span class=line>	                length--;</span><br><span class=line>	            } <span class=keyword>else</span> {</span><br><span class=line>	                index++;</span><br><span class=line>	                count++;</span><br><span class=line>	            }</span><br><span class=line>	        } <span class=keyword>else</span> {</span><br><span class=line>	            <span class=comment>// 遇到空位了，就跳到下一位，但count不加1，也就是这个位置没有报数</span></span><br><span class=line>	            index++;</span><br><span class=line>	        }</span><br><span class=line>	    }</span><br><span class=line>	</span><br><span class=line>	    <span class=keyword>return</span> index;</span><br><span class=line>	}</span><br></pre></table></figure><!--noindex--><div class=post-button><a class=btn href=/blog/2017/11/10/josephus-problem/#more rel=contents> 阅读全文 » </a></div><!--/noindex--></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2017/10/02/linux-shell/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2017/10/02/linux-shell/ itemprop=url>Linux Shell 环境变量</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2017-10-02 09:59:08" datetime=2017-10-02T09:59:08+08:00>2017-10-02</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-05-12 20:32:07" datetime=2024-05-12T20:32:07+08:00 itemprop=dateModified>2024-05-12</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Linux/ itemprop=url rel=index><span itemprop=name>Linux</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2017/10/02/linux-shell/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2017/10/02/linux-shell/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2017/10/02/linux-shell/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>12k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>11 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><h1 id=linux环境变量问题汇总>Linux环境变量问题汇总</h1><h3 id=测试好的脚本放到-crontab-里就报错-找不到命令>测试好的脚本放到 crontab 里就报错: 找不到命令</h3><p>写好一个脚本，测试没有问题，然后放到crontab 想要定时执行，但是总是报错，去看日志的话显示某些命令找不到，这种一般都是因为PATH环境变量变了导致的<p>自己在shell命令行下测试的时候当前环境变量就是这个用户的环境变量，可以通过命令：env 看到，脚本放到crontab 里面后一般都加了sudo 这个时候 env 变了。比如你可以在命令行下执行 env 和 sudo env 比较一下就发现他们很不一样<p>sudo有一个参数 -E （–preserver-env）就是为了解决这个问题的。<p>这个时候再比较一下<ul><li>env<li>sudo env<li>sudo -E env</ul><p>大概就能理解这里的区别了。<p>本文后面的回复中有同学提到了：<blockquote><p>第一个问题，sudo -E在集团的容器中貌似是不行的，没有特别好的解，我们最后是通过在要执行的脚本中手动source “/etc/profile.d/dockerenv.sh”才行</blockquote><p>我也特意去测试了一下官方的Docker容器，也有同样的问题，/etc/profile.d/dockerenv.sh 中的脚本没有生效，然后debug看了看，主要是因为bashrc中的 . 和 source 不同导致的，不能说没有生效，而是加载 /etc/profile.d/dockerenv.sh 是在一个独立的bash 进程中，加载完毕进程结束，所有加载过的变量都完成了生命周期释放了，类似我文章中的export部分提到的。我尝试把 ~/.bashrc 中的 . /etc/bashrc 改成 source /etc/bashrc , 同时也把 /etc/bashrc 中的 . 改成 source，就可以了，再次进到容器不需要任何操作就能看到所有：/etc/profile.d/dockerenv.sh 中的变量了，所以我们制作镜像的时候考虑改改这里<figure><img alt=crontab src=/images/951413iMgBlog/crontab-7372074.png><figcaption aria-hidden=true>crontab</figcaption></figure><h3 id=docker-容器中admin取不到env参数>docker 容器中admin取不到env参数</h3><p>docker run的时候带入一堆参数，用root能env中能看到这些参数，admin用户也能看见这些参数，但是通过crond用admin就没法启动应用了，因为读不到这些env。<h3 id=同样一个命令ssh执行不了-报找不到命令>同样一个命令ssh执行不了， 报找不到命令</h3><p>比如：<p>ssh user@ip ” ip a ” 报错： bash: ip: command not found<p>但是你要是先执行 ssh user@ip 连上服务器后，再执行 ip a 就可以，这里是同一个命令通过两种不同的方式使用，但是环境变量也不一样了。<p>同样想要解决这个问题的话可以先 ssh 连上服务器，再执行 which ip ; env | grep PATH<pre><code>$ which ip
/usr/sbin/ip
$ env | grep PATH
PATH=/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin</code></pre><p>很明显这里因为 ip在/usr/sbin下，而/usr/sbin又在PATH变量中，所以可以找到。<p>那么接下来我们看看<pre><code>$ssh user@ip "env | grep PATH"
PATH=/usr/local/bin:/usr/bin</code></pre><p>很明显这里的PATH比上面的PATH短了一截，/usr/sbin也没有在里面，所以/usr/sbin 下的ip命令自然也找不到了，这里虽然都是同一个用户，但是他们的环境变量还不一样，有点出乎我的意料之外。<p>主要原因是我们的shell 分为login shell 和 no-login shell , 先ssh 登陆上去再执行命令就是一个login shell，Linux要为这个终端分配资源。<p>而下面的直接在ssh 里面放执行命令实际上就不需要login，所以这是一个no-login shell.<h4 id=login-shell-和-no-login-shell又有什么区别呢>login shell 和 no-login shell又有什么区别呢？</h4><ul><li>login shell加载环境变量的顺序是：① /etc/profile ② ~/.bash_profile ③ ~/.bashrc ④ /etc/bashrc<li>而non-login shell加载环境变量的顺序是： ① ~/.bashrc ② /etc/bashrc</ul><p>也就是nog-login少了前面两步，我们先看后面两步。<p>下面是一个 .bashrc 的内容：<pre><code>$ cat .bashrc 
# .bashrc

# Source global definitions
if [ -f /etc/bashrc ]; then
    . /etc/bashrc
fi</code></pre><p>基本没有什么内容，它主要是去加载 /etc/bashrc 而他里面也没有看到sbin相关的东西<p>那我们再看non-login少的两步： ① /etc/profile ② ~/.bash_profile<p>cat /etc/profile : if [ “$EUID” = “0” ]; then pathmunge /usr/sbin pathmunge /usr/local/sbin else pathmunge /usr/local/sbin after pathmunge /usr/sbin after fi<p>这几行代码就是把 /usr/sbin 添加到 PATH 变量中，正是他们的区别决定了这里的环境变量不一样。<p><strong>用一张图来表述他们的结构，箭头代表加载顺序，红框代表不同的shell的初始入口</strong>： <img alt=image.png src=/images/oss/ae3095f063dede80a8c1ee79ec25685c.png><p>像 ansible 这种自动化工具，或者我们自己写的自动化脚本，底层通过ssh这种non-login的方式来执行的话，那么都有可能碰到这个问题，如何修复呢？<p>在 /etc/profile.d/ 下创建一个文件：/etc/profile.d/my_bashenv.sh 内容如下：<pre><code>$cat /etc/profile.d/my_bashenv.sh 

pathmunge () {
if ! echo $PATH | /bin/egrep -q "(^|:)$1($|:)" ; then
   if [ "$2" = "after" ] ; then
  PATH=$PATH:$1
   else
  PATH=$1:$PATH
   fi
fi
}
 
pathmunge /sbin
pathmunge /usr/sbin
pathmunge /usr/local/sbin
pathmunge /usr/local/bin
pathmunge /usr/X11R6/bin after
 
unset pathmunge

complete -cf sudo
 
    alias chgrp='chgrp --preserve-root'
    alias chown='chown --preserve-root'
    alias chmod='chmod --preserve-root'
    alias rm='rm -i --preserve-root'
    
HISTTIMEFORMAT='[%F %T] '
HISTSIZE=1000
export EDITOR=vim    
export PS1='\n\e[1;37m[\e[m\e[1;32m\u\e[m\e[1;33m@\e[m\e[1;35m\H\e[m \e[4m`pwd`\e[m\e[1;37m]\e[m\e[1;36m\e[m\n\$'</code></pre><p>通过前面我们可以看到 /etc/bashrc 总是会去加载 /etc/profile.d/ 下的所有 *.sh 文件，同时我们还可以在这个文件中修改我们喜欢的 shell 配色方案和环境变量等等<p><a href=https://www.gnu.org/software/bash/manual/html_node/Bash-Startup-Files.html rel=noopener target=_blank>脚本前增加如下一行是好习惯</a><figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class="meta prompt_">#</span><span class=language-bash>!/bin/bash --login</span></span><br></pre></table></figure><figure><img alt=image-20220505213833017 src=/images/951413iMgBlog/image-20220505213833017.png><figcaption aria-hidden=true>image-20220505213833017</figcaption></figure><h3 id=bash>BASH</h3><p>1、交互式的登录shell （bash –il xxx.sh） 载入的信息： /etc/profile ~/.bash_profile（ -> ~/.bashrc -> /etc/bashrc） ~/.bash_login ~/.profile<p>2、非交互式的登录shell （bash –l xxx.sh） 载入的信息： /etc/profile ~/.bash_profile （ -> ~/.bashrc -> /etc/bashrc） ~/.bash_login ~/.profile $BASH_ENV<p>3、交互式的非登录shell （bash –i xxx.sh） 载入的信息： ~/.bashrc （ -> /etc/bashrc）<p>4、非交互式的非登录shell （bash xxx.sh） 载入的信息： $BASH_ENV<h3 id=sh>SH</h3><p>1、交互式的登录shell 载入的信息：<p>/etc/profile ~/.profile<p>2、非交互式的登录shell 载入的信息：<p>/etc/profile ~/.profile<p>3、交互式的非登录shell 载入的信息：<p>$ENV<h4 id=练习验证一下bashsh和loginnon-login>练习验证一下bash、sh和login、non-login</h4><ul><li>sudo ll 或者 sudo cd 是不是都报找不到命令<li>先sudo bash 然后执行 ll或者cd就可以了<li>先sudo sh 然后执行 ll或者cd还是报找不到命令<li>sudo env | grep PATH 然后 sudo bash 后再执行 env | grep PATH 看到的PATH环境变量不一样了</ul><p><strong>找不到ll、cd命令不是因为login/non-login而是因为这两个命令是bash内部定义的，所以sh找不到，通过type -a cd 可以看到一个命令到底是哪里来的</strong><p>4、非交互式的非登录shell 载入的信息：<p>nothing<h3 id=export命令的作用>export命令的作用</h3><p>Linux 中export是一种命令工具通过export命令把shell变量中包含的用户变量导入给子程序.<strong>默认情况下子程序仅会继承父程序的环境变量</strong>，子程序不会继承父程序的自定义变量，所以需要export让父程序中的<strong>自定义变量</strong>变成环境变量，然后子程序就能继承过来了。<p>我们来看一个例子， 有一个变量，名字 abc 内容123 如果没有export ，那么通过bash创建一个新的shell（新shell是之前bash的子程序），在新的shell里面就没有abc这个变量， export之后在新的 shell 里面才可以看到这个变量，但是退出重新login后（产生了一个新的bash，只会加载env）abc变量都不在了<pre><code>$echo $abc
$abc="123"
$echo $abc
123
$bash
$echo $abc

$exit
exit

$export abc

$echo $abc
123

$bash

$echo $abc
123</code></pre><h2 id=一些常见问题>一些常见问题</h2><h3 id=执行好好地shell-脚本换台服务器就source-not-found>执行好好地shell 脚本换台服务器就：source: not found</h3><p>source 是bash的一个内建命令（所以你找不到一个/bin/source 这样的可执行文件），也就是他是bash自带的，如果我们执行脚本是这样： sh shell.sh 而shell.sh中用到了source命令的话就会报 source: not found<p>这是因为bash 和 sh是两个东西，sh是 POSIX shell，你可以把它看成是一个兼容某个规范的shell，而bash是 Bourne-Again shell script， bash是 POSIX shell的扩展，就是bash支持所有符合POSIX shell的规范，但是反过来就不一定了，而这里的 source 恰好就是 bash内建的，不符合 POSIX shell的规范（<strong>POSIX shell 中用 . 来代替source</strong>)<blockquote><p><a href=https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Bourne-Shell-Builtins rel=noopener target=_blank>. (a period)</a><p>. filename [arguments]<p>Read and execute commands from the filename argument in the current shell context. If filename does not contain a slash, the <code>PATH</code> variable is used to find filename. When Bash is not in POSIX mode, the current directory is searched if filename is not found in <code>$PATH</code>. If any arguments are supplied, they become the positional parameters when filename is executed. Otherwise the positional parameters are unchanged. If the -T option is enabled, <code>source</code> inherits any trap on <code>DEBUG</code>; if it is not, any <code>DEBUG</code> trap string is saved and restored around the call to <code>source</code>, and <code>source</code> unsets the <code>DEBUG</code> trap while it executes. If -T is not set, and the sourced file changes the <code>DEBUG</code> trap, the new value is retained when <code>source</code> completes. The return status is the exit status of the last command executed, or zero if no commands are executed. If filename is not found, or cannot be read, the return status is non-zero. This builtin is equivalent to <code>source</code>.</blockquote><h3 id=在centos执行好好的脚本放到ubuntu上就不行了报语法错误>在centos执行好好的脚本放到Ubuntu上就不行了，报语法错误</h3><p>同上，如果到ubuntu上用 bash shell.sh是可以的，但是sh shell.sh就报语法错误，但是在centos上执行：sh或者bash shell.sh 都可以通过。 在centos上执行 ls -lh /usr/bin/sh 可以看到 /usr/bin/sh link到了 /usr/bin/bash 也就是sh等同于bash，所以都可以通过不足为奇。<p>但是在ubuntu上执行 ls -lh /usr/bin/sh 可以看到 /usr/bin/sh link到了 <strong>/usr/bin/dash</strong> ， 这就是为什么ubuntu上会报错<h3 id=source-shell.sh-和-bash-shell.sh以及-.shell.sh的区别>source shell.sh 和 bash shell.sh以及 ./shell.sh的区别</h3><p>source shell.sh就在本shell中展开执行 bash shell.sh表示在本shell启动一个子程序（bash），在子程序中执行 shell.sh (shell.sh中产生的一些环境变量就没法带回父shell进程了)， 只需要有读 shell.sh 权限就可以执行 ./shell.sh 跟bash shell.sh类似，但是必须要求shell.sh有rx权限，然后根据shell.sh前面的 #! 后面的指示来确定用bash还是sh<pre><code>$cat test.sh 
echo $$

$echo $$
2299

$source test.sh 
2299

$bash test.sh 
4037

$./test.sh 
4040</code></pre><p>如上实例，只有source的时候进程ID和bash进程ID一样，其它方式都创建了一个新的bash进程，所以ID也变了。<p>bash test.sh 产生一个新的bash，但是这个新的bash中不会加载 .bashrc 需要加载的话必须 bash -l test.sh.<h3 id=通过ssh-执行命令命令前有sudo的时候报错sudo-sorry-you-must-have-a-tty-to-run-sudo>通过ssh 执行命令（命令前有sudo）的时候报错：sudo: sorry, you must have a tty to run sudo</h3><p>这是因为 /etc/sudoers (Linux控制sudo行为、权限的配置文件）中指定了 requiretty（<a href=https://www.shell-tips.com/2014/09/08/sudo-sorry-you-must-have-a-tty-to-run-sudo/ rel=noopener target=_blank>Redhat、Fedora默认行为</a>），但是 通过ssh远程执行命令是没有tty的（不需要交互）。 解决办法可以试试 ssh -t or -tt (强制分配tty）或者先修改 /etc/sudoers把 requiretty 删掉或者改成 !requiretty<h3 id=cp-命令即使使用了--f-force参数overwrite的时候还是弹出交互信息必须手工输入yyes等>cp 命令即使使用了 -f force参数，overwrite的时候还是弹出交互信息，必须手工输入Y、yes等</h3><p>Google搜索一下别人给出的方案是这样 echo yes | cp -rf xxx yyy 算是笨办法，但是没有找到这里为什么-f 不管用。 type -a cp 先确认一下 cp到底是个什么东西：<pre><code>    #type -a cp
    cp is aliased to `cp -i'
    cp is /usr/bin/cp</code></pre><p>这下算是有点清楚了，原来默认cp 都是-i了（-i, –interactive prompt before overwrite (overrides a previous -n option)），看起来就是默认情况下为了保护我们的目录不经意间被修改了。所以真的确认要overwrite的话直接用 /usr/bin/cp -f 就不需要每次yes确认了<h3 id=重定向>重定向</h3><p>sudo docker logs swarm-agent-master >master.log 2>&1 输出重定向http://www.kissyu.org/2016/12/25/shell%E4%B8%AD%3E%20:dev:null%202%20%3E%20&1%E6%98%AF%E4%BB%80%E4%B9%88%E9%AC%BC%EF%BC%9F/<pre><code>>/dev/null 2>&1 标准输出丢弃 错误输出丢弃
2>&1 >/dev/null 标准输出丢弃 错误输出屏幕</code></pre><p>http://kodango.com/bash-one-liners-explained-part-three<h3 id=umask>umask</h3><p>创建文件的默认权限是 666 文件夹是777 但是都要跟 umask做运算（按位减法） 一般umask是002 所以创建出来文件最终是664，文件夹是775，如果umask 是027的话最终文件是 640 文件夹是750 『尽量不要以数字相加减啦！』你应该要这样想(-rw-rw- rw-) – (——–wx)=-rw-rw-r–这样就对啦！不要用十进制的数字喔！够能力的话，用二进制来算，不晓得的话，用 rwx 来算喔！<h3 id=其它>其它</h3><pre><code>echo $-   // himBH </code></pre><p>“$-” 中含有“i”代表“交互式shell” “$0”的显示结果为“-bash”，bash前面多个“-”，代表“登录shell”. 没有“i“和“-”的，是“非交互式的非登录shell”<p>set +o histexpand （！ 是history展开符号， histexpand 可以打开或者关闭这个展开符） alias 之后，想要用原来的命令：+alias （命令前加)<p>bash程序执行，当“$0”是“sh”的时候，则要求下面的代码遵循一定的规范，当不符合规范的语法存在时，则会报错，所以可以这样理解，“sh”并不是一个程序，而是一种标准（POSIX），这种标准，在一定程度上（具体区别见下面的“Things bash has that sh does not”）保证了脚本的跨系统性（跨UNIX系统）<p>Linux 分 shell变量(set)，用户变量(env)， shell变量包含用户变量，export是一种命令工具，是显式那些通过export命令把shell变量中包含的用户变量导入给用户变量的那些变量.<p>set -euxo pipefail //-u unset -e 异常退出 http://www.ruanyifeng.com/blog/2017/11/bash-set.html<h3 id=引号>引号</h3><p>shell 中：单引号的处理是比较简单的，被单引号包括的所有字符都保留原有的意思，例如’$a’不会被展开, ’<code>cmd</code>’也不会执行命令；而双引号，则相对比较松，在双引号中，以下几个字符 <span class="math inline">\(, \`, \ 依然有其特殊的含义，比如\)</span>可以用于变量展开, 反引号`可以执行命令，反斜杠。但是，在双引号包围的字符串里，反斜杠的转义也是有限的，它只能转义$, `, “, （回车）这几个字符，后面如果跟着的不是这几个字符，只不会被黑底，反斜杠会被保留 http://kodango.com/simple-bash-programming-skills-2<h3 id=su-和-su---的区别>su 和 su - 的区别</h3><p>su命令和su -命令最大的本质区别就是：前者只是切换了root身份，但Shell环境仍然是普通用户的Shell；而后者连用户和Shell环境一起切换成root身份了。只有切换了Shell环境才不会出现PATH环境变量错误。su切换成root用户以后，pwd一下，发现工作目录仍然是普通用户的工作目录；而用su -命令切换以后，工作目录变成root的工作目录了。用echo $PATH命令看一下su和su -以后的环境变量有何不同。以此类推，要从当前用户切换到其它用户也一样，应该使用su -命令。<p>比如： su admin 会重新加载 ~/.bashrc ，但是不会切换到admin 的home目录。 但是 su - admin 不会重新加载 ~/.bashrc ，但是会切换admin的home目录。<p>The su command is used to become another user during a login session. Invoked without a username, su defaults to becoming the superuser. The optional argument - may be used to provide an environment similar to what the user would expect had the user logged in directly.<h3 id=后台任务执行>后台任务执行</h3><p>将任务放到后台，断开ssh后还能运行： “ctrl-Z”将当前任务挂起（实际是发送 SIGTSTP 信号），父进程ssh退出时会给所有子进程发送 SIGHUP；<p>jobs -l 查看所有job<p>“disown -h %序号” 让该任务忽略SIGHUP信号（不会因为掉线而终止执行），序号为 Jobs -l 看到的顺序号； “bg”让该任务在后台恢复运行。<h2 id=shell-调试与参数>shell 调试与参数</h2><p>为了方便 Debug，有时在启动 Bash 的时候，可以加上启动参数。<ul><li><code>-n</code>：不运行脚本，只检查是否有语法错误。<li><code>-v</code>：输出每一行语句运行结果前，会先输出该行语句。<li><code>-x</code>：每一个命令处理完以后，先输出该命令，再进行下一个命令的处理。</ul><figure class="highlight plaintext"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>$ bash -n scriptname</span><br><span class=line>$ bash -v scriptname</span><br><span class=line>$ bash -x scriptname</span><br></pre></table></figure><h2 id=shell-数值运算>shell 数值运算</h2><p>bash中数值运算要这样 $(( <span class="math inline">\(a+\)</span>b )) // declare -i 才是定义一个整型变量<ul><li>在中括号 [] 内的每个组件都需要有空白键来分隔；<li>在中括号内的变量，最好都以双引号括号起来；<li>在中括号内的常数，最好都以单或双引号括号起来。</ul><p>在bash中为变量赋值的语法是<code>foo=bar</code>，访问变量中存储的数值，其语法为 <code>$foo</code>。 需要注意的是，<code>foo = bar</code> （使用空格隔开）是不能正确工作的，因为解释器会调用程序<code>foo</code> 并将 <code>=</code> 和 <code>bar</code>作为参数。 总的来说，在shell脚本中使用空格会起到分割参数的作用，有时候可能会造成混淆，请务必多加检查。<h2 id=其它-1>其它</h2><ul><li>系统合法的 shell 均写在 /etc/shells 文件中；<li>用户默认登陆取得的 shell 记录于 /etc/passwd 的最后一个字段；<li>type 可以用来找到运行命令为何种类型，亦可用于与 which 相同的功能 [<strong>type -a</strong>]；<li>变量主要有环境变量与自定义变量，或称为全局变量与局部变量<li>使用 env 与 export 可观察环境变量，其中 export 可以将自定义变量转成环境变量；<li>set 可以观察目前 bash 环境下的所有变量；<li>stty -a<li><strong>$? 亦为变量，是前一个命令运行完毕后的回传值</strong>。在 Linux 回传值为 0 代表运行成功；<li>bash 的配置文件主要分为 login shell 与 non-login shell。login shell 主要读取 /etc/profile 与 ~/.bash_profile， non-login shell 则仅读取 ~/.bashrc</ul><p>在bash中进行比较时，尽量使用双方括号 <code>[[ ]]</code> 而不是单方括号 <code>[ ]</code>，<a href=http://mywiki.wooledge.org/BashFAQ/031 rel=noopener target=_blank>这样会降低犯错的几率</a>，尽管这样并不能兼容 <code>sh</code><h3 id=type>type</h3><p><strong>执行顺序(type -a ls 可以查看到顺序)：</strong><ol type=1><li>以相对/绝对路径运行命令，例如『 /bin/ls 』或『 ./ls 』；<li>由 alias 找到该命令来运行；<li>由 bash 内建的 (builtin) 命令来运行；<li>透过 $PATH 这个变量的顺序搜寻到的第一个命令来运行。</ol><p><a href=https://tldr.sh/ rel=noopener target=_blank>tldr 可以用来查询命令的常用语法</a>，比man简短些，偏case型<h2 id=参考文章>参考文章：</h2><p><a href=https://blog.csdn.net/u010871982/article/details/78525367 rel=noopener target=_blank>关于ansible远程执行的环境变量问题</a><p><a href=http://bbs.chinaunix.net/thread-1068678-1-1.html rel=noopener target=_blank>Bash和Sh的区别</a><p><a href=http://kodango.com/what-is-interactive-and-login-shell rel=noopener target=_blank>什么是交互式登录 Shell what-is-interactive-and-login-shell</a><p><a href=http://kodango.com/explain-shell-default-options rel=noopener target=_blank>Shell 默认选项 himBH 的解释</a><p><a href=http://kodango.com/useful-documents-about-shell rel=noopener target=_blank>useful-documents-about-shell</a><p><a href=http://coolnull.com/4432.html rel=noopener target=_blank>linux cp实现强制覆盖</a><p>https://wangdoc.com/bash/startup.html<p><a href=https://cjting.me/2020/12/10/tiny-x64-helloworld/ rel=noopener target=_blank>编写一个最小的 64 位 Hello World</a><p><a href=https://missing-semester-cn.github.io/ rel=noopener target=_blank>计算机教育中缺失的一课</a><p><a href=https://foxwho.com/article/184 rel=noopener target=_blank>MacOS设置环境变量path/paths的完全总结</a> 很详细<p>最近由于要获取几台Linux服务器的硬件配置信息，就写了一个获取硬件配置信息的脚本代码，可以获取CPU、内存、硬盘等硬件信息。<p>使用这个脚本文件，就可以一次性输出代码如下所示：<!--noindex--><div class=post-button><a class=btn href=/blog/2017/10/02/linux-shell/#more rel=contents> 阅读全文 » </a></div><!--/noindex--></div><footer class=post-footer><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" aria-label=上一页 href=/page/44/ rel=prev title=上一页><i class="fa fa-angle-left"></i></a><a class=page-number href=/>1</a><span class=space>…</span><a class=page-number href=/page/44/>44</a><span class="page-number current">45</span><a class=page-number href=/page/46/>46</a><span class=space>…</span><a class=page-number href=/page/70/>70</a><a class="extend next" aria-label=下一页 href=/page/46/ rel=next title=下一页><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2013 – <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Long Luo</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>1.6m</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>24:06</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/pisces/ rel=noopener target=_blank>NexT.Pisces</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/comments.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/utils.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/motion.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/sidebar.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/next-boot.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/bookmark.min.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/search/local-search.min.js></script><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=enableMath type=application/json>true</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/math/mathjax.min.js></script><script class=next-config data-name=waline type=application/json>{"lang":"zh-CN","enable":true,"serverURL":"https://waline.longluo.me/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":true,"libUrl":"https://unpkg.com/@waline/client@v2/dist/waline.js","locale":{"placeholder":"欢迎大家的留言！(留言只需要填昵称即可。) Welcome to comment!"},"emoji":["https://unpkg.com/@waline/emojis@1.0.1/qq"],"meta":["nick","mail","link"],"requiredMeta":[["nick"]],"wordLimit":0,"pageSize":10,"el":"#waline","comment":true,"path":"/page/45/"}</script><link href=https://unpkg.com/@waline/client@v2/dist/waline.css rel=stylesheet><script>document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});</script>