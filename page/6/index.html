<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.1.1" name=generator><link href=https://fonts.googleapis.com rel=preconnect><link href=https://cdnjs.cloudflare.com rel=preconnect><link href=https://www.longluo.me/assets/logo/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://www.longluo.me/assets/logo/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://www.longluo.me/assets/logo/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=n6mekvZa-QaR3EnDD-CzJymq7mGubpU7rvoGpKROHLE name=google-site-verification><meta content=6BFBD4DDDB3B6F4FDD26CF82BADDB931 name=msvalidate.01><meta content=a2ab49d952ea45f5 name=yandex-verification><meta content=www.longluo.me name=baidu-site-verification><link href=/css/main.css rel=stylesheet><link as=style href=https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext onload=this.rel='stylesheet' rel=preload><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css integrity=sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"www.longluo.me","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":5,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/config.min.js></script><meta content="A Curious Engineer" name=description><meta content=website property=og:type><meta content="Long Luo's Life Notes" property=og:title><meta content=https://www.longluo.me/page/6/index.html property=og:url><meta content="Long Luo's Life Notes" property=og:site_name><meta content="A Curious Engineer" property=og:description><meta content=zh_CN property=og:locale><meta content="Long Luo" property=article:author><meta content="longluo, Tech, Tech Blog, 技术博客, Personal Blog, 个人博客, Android, 安卓博客, 原创博客, Software Engineer, 软件工程师, Program, 编程, 程序员, 码农, Java, C, C++, Data Structures, 数据结构, Algorithm, 算法, Life" property=article:tag><meta content=summary name=twitter:card><link href=https://www.longluo.me/page/6/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Long Luo's Life Notes</title><script async src=https://www.googletagmanager.com/gtag/js?id=UA-46213499-2></script><script class=next-config data-name=google_analytics type=application/json>{"tracking_id":"UA-46213499-2","only_pageview":false,"measure_protocol_api_secret":null}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/analytics/google-analytics.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/analytics/baidu-analytics.min.js></script><script async src=https://hm.baidu.com/hm.js?a75fb5d0c0ef1e36c34b7f52bb7c48be></script><script async src=https://assets.growingio.com/2.1/gio.js></script><script class=next-config data-name=growingio_analytics type=application/json>"bc65befc551b6d70"</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/analytics/growingio.min.js></script><script>(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "gz2vdkhgvh");</script><script class=next-config data-name=matomo type=application/json>{"enable":true,"server_url":"https://longluo.matomo.cloud/","site_id":1}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/analytics/matomo.min.js></script><script async data-host-url=longluo.me data-website-id=2a6d2bf9-2adf-474b-a292-84ca30206507 defer src=https://analytics.us.umami.is/script.js></script><script data-domain=longluo.me defer src=https://plausible.io/js/script.js></script><link href=https://waline.longluo.me/ rel=dns-prefetch><noscript><link href=/css/noscript.css rel=stylesheet></noscript><style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><link title="Long Luo's Life Notes" href=/atom.xml rel=alternate type=application/atom+xml><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <h1 class=site-title>Long Luo's Life Notes</h1> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>每一天都是奇迹</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-works"><a href=/works rel=section><i class="fa fa-code fa-fw"></i>works</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt="Long Luo" class=site-author-image itemprop=image src=https://www.longluo.me/assets/avatar/sinc_3d_python.png><p class=site-author-name itemprop=name>Long Luo<div class=site-description itemprop=description>A Curious Engineer</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>337</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>24</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>327</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/longluo" href=https://github.com/longluo target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="ZhiHu → http://www.zhihu.com/people/longluo" href=http://www.zhihu.com/people/longluo target=_blank><i class="fab fa-quora fa-fw"></i>ZhiHu</a> </span><span class=links-of-author-item> <a rel="noopener me" title="LinkedIn → https://www.linkedin.com/in/longluo/" href=https://www.linkedin.com/in/longluo/ target=_blank><i class="fa fa-linkedin fa-fw"></i>LinkedIn</a> </span><span class=links-of-author-item> <a rel="noopener me" title="E-Mail → mailto:luolong0226@163.com" href=mailto:luolong0226@163.com target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span></div><div class="cc-license animated" itemprop=license><a class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></a></div></div></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://blog.csdn.net/tcpipstack rel=noopener target=_blank title=http://blog.csdn.net/tcpipstack>My CSDN</a><li class=links-of-blogroll-item><a href=https://www.ruanyifeng.com/home.html rel=noopener target=_blank title=https://www.ruanyifeng.com/home.html>阮一峰老师</a><li class=links-of-blogroll-item><a href=https://hutusi.com/ rel=noopener target=_blank title=https://hutusi.com/>胡涂说</a><li class=links-of-blogroll-item><a href=https://www.qtmuniao.com/ rel=noopener target=_blank title=https://www.qtmuniao.com/>木鸟杂记</a><li class=links-of-blogroll-item><a href=https://yufan.me/ rel=noopener target=_blank title=https://yufan.me/>且听书吟</a></ul></div></div></aside></div><div class="main-inner index posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2022/12/16/linux-network-commands/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2022/12/16/linux-network-commands/ itemprop=url>Linux 网络命令指南</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-12-16 22:37:12" datetime=2022-12-16T22:37:12+08:00>2022-12-16</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-04-03 20:40:17" datetime=2024-04-03T20:40:17+08:00 itemprop=dateModified>2024-04-03</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Linux/ itemprop=url rel=index><span itemprop=name>Linux</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2022/12/16/linux-network-commands/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2022/12/16/linux-network-commands/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2022/12/16/linux-network-commands/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>9.5k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>9 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><h1 id=挖坑>挖坑</h1><h1 id=网络抓包常用命令>网络抓包常用命令</h1><p>详细解析和Demo版本：<a href=https://plantegg.github.io/2019/06/21/就是要你懂抓包--WireShark之命令行版tshark/ rel=noopener target=_blank>就是要你懂抓包–WireShark之命令行版tshark</a><p>```shell 用tcpdump抓取并保存包： sudo tcpdump -i eth0 port 3306 -w plantegg.cap<p>抓到的包存储在plantegg.cap中，可以用作wireshark、tshark详细分析 如果明确知道目的ip、端口等可以通过指定条件来明确只抓取某个连接的包<p>抓取详细SQL语句： sudo tshark -i eth0 -Y “mysql.command==3” -T fields -e mysql.query sudo tshark -i eth0 -R mysql.query -T fields -e mysql.query<p>sudo tshark -i any -f ‘port 8527’ -s 0 -l -w - |strings<p>#parse 8507/4444 as mysql protocol, default only parse 3306 as mysql. sudo tshark -i eth0 -d tcp.port==8507,mysql -T fields -e mysql.query ‘port 8507’ sudo tshark -i any -c 50 -d tcp.port==4444,mysql -Y ” ((tcp.port eq 4444 ) )” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query<p>sudo tshark -i eth0 -R “ip.addr==11.163.182.137” -d tcp.port==3306,mysql -T fields -e mysql.query ‘port 3306’ sudo tshark -i eth0 -R “tcp.srcport==62877” -d tcp.port==3001,mysql -T fields -e tcp.srcport -e mysql.query ‘port 3001’<p>如果MySQL开启了SSL，那么抓包后的内容tshark/wireshark分析不到MySQL的具体内容，可以强制关闭：connectionProperties里加上useSSL=false<p>查看SQL具体内容 sudo tshark -r gege_plantegg.cap -Y “mysql.query or ( tcp.stream==1)” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e frame.time_delta_displayed -e tcp.stream -e tcp.len -e mysql.query<p>按mysql查询分析响应时间 对于rt分析，要注意一个query多个response情况（response结果多，分包了），分析这种rt的时候只看query之后的第一个response，其它连续response需要忽略掉。<p>以上抓包结果文件可以用tshark进行详细分析<p>分析MySQL rt，倒数第四列基本就是rt tshark -r gege_plantegg.pcap -Y ” ((tcp.srcport eq 3306 ) and tcp.len>0 )” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt<p>或者排序一下 tshark -r 213_php.cap -Y “mysql.query or ( tcp.srcport==3306)” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query |sort -nk9 -nk1<p>MySQL响应时间直方图【第八列的含义– Time since previous frame in this TCP stream: seconds】： tshark -r gege_plantegg.pcap -Y “mysql.query or (tcp.srcport3306 and tcp.len>60)” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len | awk ’BEGIN {sum0=0;sum3=0;sum10=0;sum30=0;sum50=0;sum100=0;sum300=0;sum500=0;sum1000=0;sumo=0;count=0;sum=0} {rt=$8; if(rt>=0.000) sum=sum+rt; count=count+1; if(rt<=0.000) sum0=sum0+1; else if(rt&LT0.003) sum3=sum3+1 ; else if(rt&LT0.01) sum10=sum10+1; else if(rt&LT0.03) sum30=sum30+1; else if(rt&LT0.05) sum50=sum50+1; else if(rt < 0.1) sum100=sum100+1; else if(rt < 0.3) sum300=sum300+1; else if(rt < 0.5) sum500=sum500+1; else if(rt < 1) sum1000=sum1000+1; else sum=sum+1 ;} END{printf “————-3ms:http response分析响应时间 tshark -nr 213_php.cap -o tcp.calculate_timestamps:true -Y”http.request or http.response” -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e ip.dst -e tcp.stream -e http.request.full_uri -e http.response.code -e http.response.phrase | sort -nk6 -nk1<p>分析rtt、丢包、deplicate等等，可以得到整体网络状态 $ tshark -r retrans.cap -q -z io,stat,1,“AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt”,“COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission”,“COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission”,“COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack”,“COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment”,“MIN(tcp.window_size)tcp.window_size”<p>=================================================================================== | IO Statistics | | | | Duration: 89.892365 secs | | Interval: 2 secs | | | | Col 1: AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt | | 2: COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission | | 3: COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission | | 4: COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack | | 5: COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment | | 6: AVG(tcp.window_size)tcp.window_size | |———————————————————————————| | |1 |2 |3 |4 |5 |6 | | | Interval | AVG | COUNT | COUNT | COUNT | COUNT | AVG | | |————————————————————-| | | 0 <> 2 | 0.001152 | 0 | 0 | 0 | 0 | 4206 | | | 2 <> 4 | 0.002088 | 0 | 0 | 0 | 1 | 6931 | | | 4 <> 6 | 0.001512 | 0 | 0 | 0 | 0 | 7099 | | | 6 <> 8 | 0.002859 | 0 | 0 | 0 | 0 | 7171 | | | 8 <> 10 | 0.001716 | 0 | 0 | 0 | 0 | 6472 | | | 10 <> 12 | 0.000319 | 0 | 0 | 0 | 2 | 5575 | | | 12 <> 14 | 0.002030 | 0 | 0 | 0 | 0 | 6922 | | | 14 <> 16 | 0.003371 | 0 | 0 | 0 | 2 | 5884 | | | 16 <> 18 | 0.000138 | 0 | 0 | 0 | 1 | 3480 | | | 18 <> 20 | 0.000999 | 0 | 0 | 0 | 4 | 6665 | | | 20 <> 22 | 0.000682 | 0 | 0 | 41 | 2 | 5484 | | | 22 <> 24 | 0.002302 | 2 | 0 | 19 | 0 | 7127 | | | 24 <> 26 | 0.000156 | 1 | 0 | 22 | 0 | 3042 | | | 26 <> 28 | 0.000000 | 1 | 0 | 19 | 1 | 152 | | | 28 <> 30 | 0.001498 | 1 | 0 | 24 | 0 | 5615 | | | 30 <> 32 | 0.000235 | 0 | 0 | 44 | 0 | 1880 | | 1 =================================================================================== 2 | IO Statistics | 3 | | 4 | Duration: 89.892365 secs | 5 | Interval: 2 secs | 6 | | 7 | Col 1: AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt | 8 | 2: COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission | 9 | 3: COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission | 10 | 4: COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack | 11 | 5: COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment | 12 | 6: AVG(tcp.window_size)tcp.window_size | 13 |———————————————————————————| 14 | |1 |2 |3 |4 |5 |6 | | 15 | Interval | AVG | COUNT | COUNT | COUNT | COUNT | AVG | | 16 |————————————————————-| | 17 | 0 <> 2 | 0.001152 | 0 | 0 | 0 | 0 | 4206 | | 18 | 2 <> 4 | 0.002088 | 0 | 0 | 0 | 1 | 6931 | | 19 | 4 <> 6 | 0.001512 | 0 | 0 | 0 | 0 | 7099 | | 20 | 6 <> 8 | 0.002859 | 0 | 0 | 0 | 0 | 7171 | | 21 | 8 <> 10 | 0.001716 | 0 | 0 | 0 | 0 | 6472 | | 22 | 10 <> 12 | 0.000319 | 0 | 0 | 0 | 2 | 5575 | | 23 | 12 <> 14 | 0.002030 | 0 | 0 | 0 | 0 | 6922 | | 24 | 14 <> 16 | 0.003371 | 0 | 0 | 0 | 2 | 5884 | | 25 | 16 <> 18 | 0.000138 | 0 | 0 | 0 | 1 | 3480 | | 26 | 18 <> 20 | 0.000999 | 0 | 0 | 0 | 4 | 6665 | | 27 | 20 <> 22 | 0.000682 | 0 | 0 | 41 | 2 | 5484 | | 28 | 22 <> 24 | 0.002302 | 2 | 0 | 19 | 0 | 7127 | | 29 | 24 <> 26 | 0.000156 | 1 | 0 | 22 | 0 | 3042 | | 30 | 26 <> 28 | 0.000000 | 1 | 0 | 19 | 1 | 152 | | 31 | 28 <> 30 | 0.001498 | 1 | 0 | 24 | 0 | 5615 | | 32 | 30 <> 32 | 0.000235 | 0 | 0 | 44 | 0 | 1880 | |<p>#tshark tshark -r ./mysql-compress.cap -o tcp.calculate_timestamps:true -T fields -e mysql.caps.cp -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e frame.time_delta_displayed -e tcp.stream -e tcp.len -e mysql.query<p>#用tcpdump抓取并保存包： sudo tcpdump -i eth0 port 3306 -w plantegg.cap<p>#每隔3秒钟生成一个新文件，总共生成5个文件后（15秒后）终止抓包，然后包名也按时间规范好了 sudo tcpdump -t -s 0 tcp port 3306 -w ‘dump_%Y-%m-%d_%H:%M:%S.pcap’ -G 3 -W 5 -Z root<p>#每隔30分钟生成一个包并压缩 nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w ‘dump_%Y-%m-%d_%H:%M:%S.pcap’ -G 1800 -W 48 -Z root -z gzip &<p>#file size 1000M nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w ‘dump_’ -C 1000 -W 300 -Z root -z gzip &<p>#port range sudo tcpdump -i enp44s0f0 -t -s 0 portrange 3000-3100 -w ‘dump_%Y-%m-%d_%H:%M:%S.pcap’ -G 60 -W 100 -Z root<p>#subnet sudo tcpdump -i enp44s0f0 -t -s 0 net 192.168.0.1/28 -w ‘dump_%Y-%m-%d_%H:%M:%S.pcap’ -G 60 -W 100 -Z root<p>#抓取详细SQL语句, 快速确认client发过来的具体SQL内容： sudo tshark -i any -f ‘port 8527’ -s 0 -l -w - |strings sudo tshark -i eth0 -d tcp.port==3306,mysql -T fields -e mysql.query ‘port 3306’ sudo tshark -i eth0 -R “ip.addr==11.163.182.137” -d tcp.port==3306,mysql -T fields -e mysql.query ‘port 3306’ sudo tshark -i eth0 -R “tcp.srcport==62877” -d tcp.port==3001,mysql -T fields -e tcp.srcport -e mysql.query ‘port 3001’<p>#query time sudo tshark -i eth0 -Y ” ((tcp.port eq 3306 ) and tcp.len>0 )” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query<p>#如果MySQL开启了SSL，那么抓包后的内容tshark/wireshark分析不到MySQL的具体内容，可以强制关闭：connectionProperties里加上useSSL=false<p>tshark -r ./manager.cap -o tcp.calculate_timestamps:true -Y ” tcp.analysis.retransmission ” -T fields -e tcp.stream -e frame.number -e frame.time -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst | sort<p>#MySQL响应时间直方图【第八列的含义– Time since previous frame in this TCP stream: seconds】： tshark -r gege_plantegg.pcap -Y “mysql.query or (tcp.srcport3306 and tcp.len>60)” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len | awk ‘BEGIN {sum0=0;sum3=0;sum10=0;sum30=0;sum50=0;sum100=0;sum300=0;sum500=0;sum1000=0;sumo=0;count=0;sum=0} {rt=$8; if(rt>=0.000) sum=sum+rt; count=count+1; if(rt<=0.000) sum0=sum0+1; else if(rt&LT0.003) sum3=sum3+1 ; else if(rt&LT0.01) sum10=sum10+1; else if(rt&LT0.03) sum30=sum30+1; else if(rt&LT0.05) sum50=sum50+1; else if(rt < 0.1) sum100=sum100+1; else if(rt < 0.3) sum300=sum300+1; else if(rt < 0.5) sum500=sum500+1; else if(rt < 1) sum1000=sum1000+1; else sum=sum+1 ;} END{printf “————-3ms:%s 10ms:%s 30ms:%s 50ms:%s 100ms:%s 300ms:%s 500ms:%s 1000ms:%s >1s:%s————-: %.6f ” , sum3,sum10,sum30,sum50,sum100,sum300,sum500,sum1000,sumo,sum/count;}’<p>#分析MySQL rt，倒数第四列基本就是rt tshark -r gege_plantegg.pcap -Y ” ((tcp.srcport eq 3306 ) and tcp.len>0 )” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt<p>#或者排序一下 tshark -r 213_php.cap -Y “mysql.query or ( tcp.srcport==3306)” -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch -e frame.time_delta_displayed -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query |sort -nk9 -nk1<p>#将 tls key和抓包文件合并 editcap –inject-secrets tls,key.log in.pcap out.pcap #把包长截掉，只保留前面54，可以脱敏包内容 editcap -s 54 old.pcap new.pcap<h1 id=参考文献>参考文献</h1><ol type=1><li><a href=https://techjunction.co/the-most-useful-linux-commands-for-network-and-systems-administrators/ rel=noopener target=_blank>The Most Useful Linux Commands For Network And Systems Administrators</a><li><a href=https://www.redhat.com/sysadmin/7-great-network-commands rel=noopener target=_blank>7 Linux networking commands that every sysadmin should know</a><li><a href=https://earthly.dev/blog/linux-network-commands/ rel=noopener target=_blank>Mastering Linux Networking Commands: A Comprehensive Guide</a><li><a href=https://mindmajix.com/linux-networking-commands-best-examples rel=noopener target=_blank>Linux Networking Commands with Examples</a></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2022/12/08/bezier-curve/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2022/12/08/bezier-curve/ itemprop=url>贝塞尔曲线(Bezier Curve)：优雅背后的数学原理</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-12-08 08:08:07" datetime=2022-12-08T08:08:07+08:00>2022-12-08</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-11-14 22:24:40" datetime=2023-11-14T22:24:40+08:00 itemprop=dateModified>2023-11-14</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Math/ itemprop=url rel=index><span itemprop=name>Math</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2022/12/08/bezier-curve/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2022/12/08/bezier-curve/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2022/12/08/bezier-curve/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>1.5k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>1 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p>最近在 YouTube 上看了 <a href=https://www.youtube.com/@Acegikmo/videos rel=noopener target=_blank>Freya Holmér</a> 的 <a href=https://www.youtube.com/watch?v=aVwxzDHniEw rel=noopener target=_blank>贝塞尔曲线之美</a> 的视频，这个视频做的非常好，通俗易懂地解释了贝塞尔曲线的实现原理，通过结合代码，大致了解了 <strong>Bezier Curve</strong><a class=footnote-ref href=#fn1 id=fnref1 role=doc-noteref><sup>1</sup></a> 的数学原理。<p>之前用过 <a href=https://ti.com rel=noopener target=_blank>TI</a> 的一个开发板，里面有个屏保的程序，可以在开发板的屏幕上 <a href=https://github.com/longluo/ScreenSaver rel=noopener target=_blank>屏保</a> ，用的是 <strong>Bresneham</strong><a class=footnote-ref href=#fn2 id=fnref2 role=doc-noteref><sup>2</sup></a> 算法，<a href=https://github.com/longluo/ScreenSaver/blob/master/Source/App/Src/screen_saver.c rel=noopener target=_blank>源码如下</a> 。<strong>Bresneham</strong> 算法先挖个坑，后续会填上，今天这篇文章主要还是分析<strong>贝塞尔曲线</strong>(Bezier Curve)。<h1 id=贝塞尔曲线是什么>贝塞尔曲线是什么？</h1><p>贝塞尔曲线是由法国工程师 Pierre Bézier<a class=footnote-ref href=#fn3 id=fnref3 role=doc-noteref><sup>3</sup></a> 在 1962 年提出的数学概念，它以其优雅的曲线特性和广泛的应用领域而闻名。<p>我写了一个贝塞尔(Bezier Curve) 曲线的在线交互式动画，传送门如下：<p>http://www.longluo.me/projects/bezier/<figure><img alt="Bezier Curve" src=https://user-images.githubusercontent.com/3395062/245307552-7dce0fdb-bbd7-47a3-87a1-d768c54756d6.png><figcaption aria-hidden=true>Bezier Curve</figcaption></figure><h1 id=贝塞尔曲线的数学原理>贝塞尔曲线的数学原理</h1><h2 id=这一章节待完善>这一章节待完善！！！</h2><p>贝塞尔曲线通过控制点来定义曲线的形状，这些控制点决定了曲线在起始点和结束点之间的路径。通过调整控制点的位置，可以改变曲线的形状、弯曲度和方向。贝塞尔曲线的绘制基于插值的概念，它通过在控制点之间进行插值计算，得到平滑的曲线。<p><span class="math inline">\(P_1(x_1, y_1)\)</span> 和 <span class="math inline">\(P_2(x_2, y_2)\)</span> ，<p><span class="math display">\[ \begin{cases} x = x_1 + t (x_2 - x_1) \\ y = y_1 + t (y_2 - y_1) \end{cases} \]</span><p>贝塞尔曲线的数学表达方式是通过多项式来定义的。在一维空间中，<span class="math inline">\(n\)</span> 次贝塞尔曲线的公式为：<p><span class="math display">\[ B(t) = P_0 + (P_1 - P_0)t= (1-t)P_0 + tP_1, t\in [0,1] \]</span><p><span class="math display">\[ B(t) = \sum_{i=0}^{n} \binom{n}{i}P_i(1 - t)^{n-i}t^i = \binom{n}{0}P_0(1-t)^{n}t^0 + \binom{n}{1}P_1(1-t)^{n-1}t^1 + \cdots + \binom{n}{n-1}P_{n-1}(1-t)^{n-1}t^{n-1} + \binom{n}{n}P_{n}(1-t)^{n}t^{n}, t\in[0,1] \]</span><p>一般地， n 个控制点的贝塞尔曲线的递归版本为：<p><span class="math display">\[ P_0^{n} = (1 - t)P_0^{n-1} + tP_1^{n-1}, t\in [0,1] \]</span><h1 id=贝塞尔曲线的应用场合>贝塞尔曲线的应用场合</h1><p>计算机图形学：贝塞尔曲线被广泛应用于计算机图形学中的曲线绘制和造型。它可以用来绘制平滑的曲线、实现曲线的动画效果，以及创建复杂的几何形状。<p>平面设计和艺术：贝塞尔曲线在平面设计和艺术创作中也有广泛应用。设计师可以利用贝塞尔曲线的灵活性和精确性，绘制出符合设计要求的曲线和形状。<p>工程和建筑设计：贝塞尔曲线在工程和建筑设计中用于绘制道路、河流、管道等具有曲线特征的结构。它可以帮助工程师和建筑师准确地描述和模拟复杂的曲线路径。<h1 id=贝塞尔曲线的缺点>贝塞尔曲线的缺点</h1><p>尽管贝塞尔曲线在许多场合下都有广泛应用，但也存在一些不适用的情况。以下是一些例子：<ol type=1><li>高度精确的曲线：贝塞尔曲线是由有限个控制点所定义的，当需要绘制极其精确的曲线时，可能无法满足需求；<li>曲率变化较大的曲线：贝塞尔曲线的控制点数量决定了曲线的平滑程度。在曲率变化较大的情况下，可能需要增加更多的控制点来准确描述曲线的形状；<li>特殊曲线类型：某些特殊曲线类型，如圆或椭圆等，可能有更适合的数学表示方法，而不是使用贝塞尔曲线。</ol><h1 id=总结>总结</h1><p>贝塞尔曲线能够帮助我们创建平滑、灵活的曲线，适用于计算机图形学、平面设计、工程和建筑设计等领域。<h1 id=参考文献>参考文献</h1><section class="footnotes footnotes-end-of-document" id=footnotes role=doc-endnotes><hr><ol><li id=fn1><p><a href=https://simple.wikipedia.org/wiki/B%C3%A9zier_curve rel=noopener target=_blank>Bézier Curve</a><a class=footnote-back href=#fnref1 role=doc-backlink>↩︎</a><li id=fn2><p><a href=https://fr.wikipedia.org/wiki/Pierre_B%C3%A9zier rel=noopener target=_blank>Bresneham</a><a class=footnote-back href=#fnref2 role=doc-backlink>↩︎</a><li id=fn3><p><a href=https://fr.wikipedia.org/wiki/Pierre_B%C3%A9zier rel=noopener target=_blank>Pierre Bézier</a><a class=footnote-back href=#fnref3 role=doc-backlink>↩︎</a></ol></section></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/ itemprop=url>[LeetCode][380. Insert Delete GetRandom O(1)] Data Structures: Thought Process from HashMap to HashMap + Array</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-11-29 11:02:57" datetime=2022-11-29T11:02:57+08:00>2022-11-29</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-03-05 20:50:50" datetime=2024-03-05T20:50:50+08:00 itemprop=dateModified>2024-03-05</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Leetcode/ itemprop=url rel=index><span itemprop=name>Leetcode</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>2.2k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>2 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p>This article is the solution <a href=https://leetcode.com/problems/insert-delete-getrandom-o1/solutions/2858411/data-structures-thought-process-from-hashmap-to-hashmap-array/ rel=noopener target=_blank>Data Structures: Thought Process from HashMap to HashMap + Array</a> of Problem <a href=https://leetcode.com/problems/insert-delete-getrandom-o1/ rel=noopener target=_blank>380. Insert Delete GetRandom O(1)</a>.<h1 id=intuition>Intuition</h1><p>It’s easy to think of using a Hash Table to achieve <span class="math inline">\(O(1)\)</span> time complexity for <span class="math inline">\(\texttt{insert}\)</span> and <span class="math inline">\(\texttt{remove}\)</span> operations. However, we need <span class="math inline">\(O(1)\)</span> time complexity to complete the <span class="math inline">\(\texttt{getRandom}\)</span> operation.<p>The Array structure can complete the operation of obtaining random elements in <span class="math inline">\(O(1)\)</span> time complexity, but it can’t completed the <span class="math inline">\(\texttt{insert}\)</span> and <span class="math inline">\(\texttt{remove}\)</span> operations in <span class="math inline">\(O(1)\)</span> time complexity.<p>So <strong>How?</strong><p><strong>Aha!!!</strong><!--noindex--><div class=post-button><a class=btn href=/blog/2022/11/29/leetcode-insert-delete-getrandom-o1/#more rel=contents> 阅读全文 » </a></div><!--/noindex--></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/ itemprop=url>[LeetCode][2475. 数组中不等三元组的数目] 2种 O(n) 时间复杂度算法</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-11-20 15:19:56" datetime=2022-11-20T15:19:56+08:00>2022-11-20</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-03-05 20:54:46" datetime=2024-03-05T20:54:46+08:00 itemprop=dateModified>2024-03-05</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Leetcode/ itemprop=url rel=index><span itemprop=name>Leetcode</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>1.7k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>2 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p>今天 <a href=https://leetcode.cn/contest/weekly-contest-320/ rel=noopener target=_blank>LeetCode 第320场周赛</a> 中第一题是 <a href=https://leetcode.cn/problems/number-of-unequal-triplets-in-array/ rel=noopener target=_blank>2475. 数组中不等三元组的数目</a> ，本文是该题的题解，同时发表在 <a href=https://leetcode.cn/problems/number-of-unequal-triplets-in-array/solution/by-longluo-kg4a/ rel=noopener target=_blank>这里</a> 。<p>参考了 <a href=https://leetcode.cn/u/endlesscheng/ rel=noopener target=_blank><span class=citation data-cites=灵茶山艾府>@灵茶山艾府</span></a> 的题解 <a href=https://leetcode.cn/problems/number-of-unequal-triplets-in-array/solution/fei-bao-li-zuo-fa-by-endlesscheng-9ekp/ rel=noopener target=_blank>非暴力做法</a> ，实际上我们可以不用先<strong>排序</strong>，而是先用 <span class="math inline">\(\texttt{HashMap}\)</span> 统计数组 <span class="math inline">\(\textit{num}\)</span> 元素频率。<p>之后遍历 <span class="math inline">\(\texttt{HashMap}\)</span> ，结果为：<span class="math inline">\(\sum_{j = 0}^{n} (map[0] + \cdots + map[i]) \times map[j] \times (map[k] + \cdots + map[n - 1])\)</span> ，其中 <span class="math inline">\(n\)</span> 为 <span class="math inline">\(\textit{nums}\)</span> 的长度。<p><strong>证明</strong>如下：<p>对于数组中的元素 <span class="math inline">\(x\)</span> ，可以得到：<ul><li>小于 <span class="math inline">\(x\)</span> 的数有 <span class="math inline">\(a\)</span> 个；<li>等于 <span class="math inline">\(x\)</span> 的数有 <span class="math inline">\(b\)</span> 个；<li>大于 <span class="math inline">\(x\)</span> 的数有 <span class="math inline">\(c\)</span> 个。</ul><p>那么 <span class="math inline">\(x\)</span> 对最终答案的贡献是 <span class="math inline">\(abc\)</span> 。<p>即使 <span class="math inline">\(x\)</span> 是<strong>三元组</strong>中的<strong>最大</strong>或<strong>最小</strong>值，由于 <span class="math inline">\(i, j, k\)</span> 的对称性，很明显其实和 <span class="math inline">\(x\)</span> 是<strong>中间值</strong>都是同一个答案。<p><strong>证毕！</strong><!--noindex--><div class=post-button><a class=btn href=/blog/2022/11/20/leetcode-number-of-unequal-triplets-in-array/#more rel=contents> 阅读全文 » </a></div><!--/noindex--></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article><link href=https://www.longluo.me/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://www.longluo.me/assets/avatar/sinc_3d_python.png itemprop=image> <meta content="Long Luo" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Long Luo's Life Notes" itemprop=name> <meta content="A Curious Engineer" itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="undefined | Long Luo's Life Notes" itemprop=name> <meta itemprop=description> </span><header class=post-header><h2 itemprop="name headline" class=post-title><a class=post-title-link href=/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/ itemprop=url>[LeetCode][947. Most Stones Removed with Same Row or Column] It is Literally a Graph: DFS and Union Find</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-11-14 09:23:41" datetime=2022-11-14T09:23:41+08:00>2022-11-14</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-03-05 20:54:16" datetime=2024-03-05T20:54:16+08:00 itemprop=dateModified>2024-03-05</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/Leetcode/ itemprop=url rel=index><span itemprop=name>Leetcode</span></a> </span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-comment"></i> </span> <span class=post-meta-item-text>Waline：</span> <a href=/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/#waline itemprop=discussionUrl title=waline> <span class="post-comments-count waline-comment-count" data-path=/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/ itemprop=commentCount></span> </a> </span><span class=post-meta-item title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span class=waline-pageview-count data-path=/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>2.9k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>3 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><strong><em>By Long Luo</em></strong><p>This article is the solution <a href=https://leetcode.com/problems/most-stones-removed-with-same-row-or-column/solutions/2812465/it-s-literally-a-graph-dfs-and-union-find/ rel=noopener target=_blank>It is Literally a Graph: DFS and Union Find</a> of Problem <a href=https://leetcode.com/problems/most-stones-removed-with-same-row-or-column/ rel=noopener target=_blank>947. Most Stones Removed with Same Row or Column</a>.<h1 id=intuition>Intuition</h1><p>We can find that this is a <strong>graph theory</strong> problem with analysis.<p>Imagine the stone on the 2D coordinate plane as the vertex of the <strong>graph</strong>, If the x-coord or the y-coord of two stones are the same, there is an edge between them.<p>This can be show as follows:<figure><img alt=947.png src=https://assets.leetcode.com/users/images/7fed588d-b4d4-4054-bd54-107992309ced_1668388259.5949304.png><figcaption aria-hidden=true>947.png</figcaption></figure><p>According to the rule that stones can be removed, we should remove those points that are in the same row or column with other points as late as possible. That is, the more points in the same row or column with point A, the later point A should be removed. In this way, we can delete as many points as possible through point A.<p>It can be found that all vertices in a connected graph can be deleted to only one vertex.<figure><img alt="947 2.png" src=https://assets.leetcode.com/users/images/bcb48b5e-7c72-4083-8630-570cf8201e57_1668388321.9239075.png><figcaption aria-hidden=true>947 2.png</figcaption></figure><p>Since these vertices are in a connected graph, all vertices of the connected graph can be traversed by DFS or BFS.<p>Therefore: the maximum number of stones that can be removed = the number of all stones - the number of connected components.<!--noindex--><div class=post-button><a class=btn href=/blog/2022/11/14/leetcode-most-stones-removed-with-same-row-or-column/#more rel=contents> 阅读全文 » </a></div><!--/noindex--></div><footer class=post-footer><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" aria-label=上一页 href=/page/5/ rel=prev title=上一页><i class="fa fa-angle-left"></i></a><a class=page-number href=/>1</a><span class=space>…</span><a class=page-number href=/page/5/>5</a><span class="page-number current">6</span><a class=page-number href=/page/7/>7</a><span class=space>…</span><a class=page-number href=/page/68/>68</a><a class="extend next" aria-label=下一页 href=/page/7/ rel=next title=下一页><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2013 – <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Long Luo</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>1.5m</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>22:36</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/pisces/ rel=noopener target=_blank>NexT.Pisces</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/comments.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/utils.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/motion.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/sidebar.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/next-boot.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/bookmark.min.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/search/local-search.min.js></script><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=enableMath type=application/json>true</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.20.0/third-party/math/mathjax.min.js></script><script class=next-config data-name=waline type=application/json>{"lang":"zh-CN","enable":true,"serverURL":"https://waline.longluo.me/","cssUrl":"https://unpkg.com/@waline/client@2.15.8/dist/waline.css","commentCount":true,"pageview":true,"libUrl":"https://unpkg.com/@waline/client@2.15.8/dist/waline.js","locale":{"placeholder":"欢迎大家的留言和评论！(评论只需要填昵称即可。) Welcome to comment"},"emoji":["https://unpkg.com/@waline/emojis@1.0.1/qq"],"meta":["nick","mail","link"],"requiredMeta":[["nick"]],"wordLimit":0,"pageSize":10,"el":"#waline","comment":true,"path":"/page/6/"}</script><link href=https://unpkg.com/@waline/client@2.15.8/dist/waline.css rel=stylesheet><script>document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});</script>