"use strict";(function(){const t=document.getElementById("cvs_track");const a=t.getContext("2d");const B=document.querySelectorAll('input[type="range"]');const Y=document.querySelectorAll('input[type="number"]');function q(){t.width=window.innerWidth;t.height=window.innerHeight;console.log("w = "+t.width+", h = "+t.height)}q();window.addEventListener("resize",q);t.addEventListener("click",j);var i=300;var l=300;var A=10;var o=5;var s=.01;var u=10;var J=.5;var O=1;var v=0;var d=0;var n=0;var r=0;var h=0;var c=0;var f=0;var p=0;var g=0;var m=0;var y=0;var E=0;var w=0;var b=0;let X=new Date;var H=50;var P=[];var R=0;window.addEventListener("load",function(e){document.body.appendChild(t);I();k()});function j(e){i=e.clientX;l=e.clientY}function k(){let e=new Date;let t=(e-X)/1e3;if(t<=0){return}K(t);G(t);te();setInterval(k,20);X=e}function I(){v=100;n=0;h=0;d=100;r=0;c=0;f=0;g=0;p=0;m=0}function G(e){var t=i-v;var n=l-d;var a=t;var r=n;g=g+t*e;m=m+n*e;y=(t-f)/e;E=(n-p)/e;w=o*a+s*g+u*y;b=o*r+s*m+u*E;f=t;p=n}function K(e){h=w/A;n+=h*e;v+=h*e*e/2+n*e;c=b/A;r+=c*e;d+=c*e*e/2+r*e}function N(){for(var e=0;e<P.length;++e){a.fillStyle="rgba(96, 185, 154,"+e/P.length+")";a.beginPath();a.arc(P[e][0],P[e][1],5,0,2*Math.PI,false);a.closePath();a.fill();var t=Math.abs(i-P[e][0]);var n=Math.abs(l-P[e][1])}}function Q(){a.strokeStyle="#E7D492";a.lineWidth=5;a.setLineDash([8,14]);a.beginPath();a.moveTo(i,l);a.lineTo(v,d);a.stroke();a.setLineDash([])}function U(){a.fillStyle="#ff5733";a.beginPath();a.arc(v,d,15,0,2*Math.PI,false);a.closePath();a.fill()}function V(){a.strokeStyle="#CE2029";a.lineWidth=8;a.lineCap="round";a.beginPath();a.moveTo(v,d);a.lineTo(v-w/10,d);a.stroke();a.beginPath();a.lineTo(v,d);a.lineTo(v,d-b/10);a.stroke()}function Z(){a.beginPath();a.arc(i,l,7,0,2*Math.PI);a.fillStyle="blue";a.fill()}function $(){a.strokeStyle="#0F0";a.lineWidth=5;a.lineCap="round";a.beginPath();a.moveTo(v,d);a.lineTo(v+h/3,d+c/3);a.stroke()}function ee(){a.strokeStyle="#00F";a.lineWidth=5;a.lineCap="round";a.beginPath();a.moveTo(v,d);a.lineTo(v+n/3,d+r/3);a.stroke()}function te(){if(++R==5){R=0;if(P.length>=H){P.shift()}P.push([v,d])}a.fillStyle="#C7EDCC";a.fillRect(0,0,t.width,t.height);N();Q();U();V();ee();$();Z()}I();k(0);var e=document.getElementById("kp");var S=document.getElementById("ki");var L=document.getElementById("kd");B.forEach(function(e,n){e.addEventListener("input",function(e){const t=e.target.value;Y[n].value=t;x()})});Y.forEach(function(e,n){e.addEventListener("input",function(e){const t=e.target.value;B[n].value=t;x()})});function x(){o=parseFloat(e.value);s=parseFloat(S.value);u=parseFloat(L.value);I()}e.addEventListener("blur",x);S.addEventListener("blur",x);L.addEventListener("blur",x);e.value=o;S.value=s;L.value=u;var C=[];var T=[];var D=[];var ne=new CanvasJS.Chart("plot_pid_x",{animationEnabled:true,exportEnabled:true,title:{text:"PID X"},axisY:{title:"Output"},toolTip:{shared:true},data:[{type:"spline",name:"Error(差值)",showInLegend:true,markerSize:0,dataPoints:C},{type:"spline",name:"Integral(积分量)",showInLegend:true,markerSize:0,dataPoints:T},{type:"spline",name:"Derivative(微分量)",showInLegend:true,markerSize:0,dataPoints:D}]});var z=[];var F=[];var M=[];var ae=new CanvasJS.Chart("plot_pid_y",{animationEnabled:true,exportEnabled:true,title:{text:"PID Y"},axisY:{title:"Output"},toolTip:{shared:true},data:[{type:"spline",name:"Error(差值)",showInLegend:true,markerSize:0,dataPoints:z},{type:"spline",name:"Integral(积分量)",showInLegend:true,markerSize:0,dataPoints:F},{type:"spline",name:"Derivative(微分量)",showInLegend:true,markerSize:0,dataPoints:M}]});var W=0;var re=20;var _=100;var ie=function(){C.push({x:W,y:f});T.push({x:W,y:g});D.push({x:W,y:y});z.push({x:W,y:p});F.push({x:W,y:m});M.push({x:W,y:E});W++;if(C.length>_||T.length>_||D.length>_){C.shift();T.shift();D.shift();z.shift();F.shift();M.shift()}ne.render();ae.render()};setInterval(function(){ie()},re)})();