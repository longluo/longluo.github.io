let my={};function init(){my.wd=600;my.ht=600;my.can=new Can("canvasId",my.wd,my.ht,2);my.maxPoints=273;my.imgHome="./img/";let p=this;this.image=new Image;this.image.onload=function(){p.wd=this.width;p.ht=this.height;update()};this.image.src=my.imgHome+"seed.gif"}function update(){let g=my.can.g;let el=my.can.el;g.beginPath();g.fillStyle="#111";g.rect(0,20,el.width,el.height);g.fill();let dtheta=parseFloat(document.getElementById("dtheta").value);my.dt=2*Math.PI*dtheta;if(isNaN(dtheta)){return}if(dtheta==0){return}my.r1=4.2;my.rad=0;my.theSize=3;my.pts=[];my.theta=0;my.midX=my.wd/2;my.midY=40+(my.ht-40)/2;my.animQ=true;doAnim()}function doAnim(){my.rad+=my.theSize;let x,y,gap;do{x=my.midX+my.rad*Math.cos(my.theta);y=my.midY+my.rad*Math.sin(my.theta);gap=minDist(x,y)-my.theSize*2;if(gap>2){my.rad-=gap/2}else{my.rad-=1}}while(gap>0);my.pts.push([x,y]);let scale=my.theSize*3.2;let g=my.can.g;transPaint(g,this.image,my.theta+my.r1,x,y,67,67,scale/100);my.theta+=my.dt;my.theSize+=.05;let dOut=60;if(y<-dOut){my.animQ=false}if(y>my.ht+dOut){my.animQ=false}if(x<-dOut){my.animQ=false}if(x>my.wt+dOut){my.animQ=false}if(my.pts.length>=my.maxPoints){my.animQ=false}if(my.animQ){requestAnimationFrame(doAnim)}}function minDist(xn,yn){let min=1e3;if(my.pts.length==0){return 0}for(let i=0;i<my.pts.length;i++){let d=dist(my.pts[i][0]-xn,my.pts[i][1]-yn);if(d<min)min=d}return min}function transPaint(g,image,angleInRad,positionX,positionY,wd,ht,size){g.translate(positionX,positionY);g.rotate(angleInRad);g.drawImage(image,-wd*size/2,-ht*size/2,wd*size,ht*size);g.rotate(-angleInRad);g.translate(-positionX,-positionY)}function dist(dx,dy){return Math.sqrt(dx*dx+dy*dy)}function goBtn(){update()}function stopBtn(){my.animQ=false}function docInsert(s){let div=document.createElement("div");div.innerHTML=s;let script=document.currentScript;script.parentElement.insertBefore(div,script)}class Can{constructor(id,wd,ht,ratio){this.id=id;this.wd=wd;this.ht=ht;this.ratio=ratio;let el=document.getElementById(id);el.width=wd*ratio;el.style.width=wd+"px";el.height=ht*ratio;el.style.height=ht+"px";this.g=el.getContext("2d");this.g.setTransform(ratio,0,0,ratio,0,0);this.el=el;return this}clear(){this.g.clearRect(0,0,this.wd,this.ht)}}init();